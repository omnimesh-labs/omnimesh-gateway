server:
  host: "0.0.0.0"
  port: 8080
  base_url: "http://localhost:8080"  # Override for development
  read_timeout: 30s
  write_timeout: 30s
  idle_timeout: 120s
  tls:
    enabled: false
database:
  host: "${DB_HOST:-localhost}"
  port: ${DB_PORT:-5432}
  database: "${DB_DATABASE:-postgres}"
  user: "${DB_USERNAME:-postgres}"
  password: "${DB_PASSWORD:-changeme123}"
  ssl_mode: "${DB_SSL_MODE:-disable}"
  max_open_conns: 25
  max_idle_conns: 5
  max_lifetime: 1h

auth:
  access_token_expiry: 15m
  refresh_token_expiry: 168h  # 7 days
  api_key_expiry: 8760h       # 365 days
  password_min_length: 8
  enable_registration: true
  require_email_verify: false

rate_limit:
  enabled: true
  storage: "redis"
  default_limit: 100
  default_window: 1m
  cleanup_interval: 1h
  # IP-based rate limiting
  ip_enabled: true
  ip_requests_per_minute: 100
  ip_skip_paths:
    - "/health"
    - "/metrics"
    - "/debug"
  ip_custom_headers:
    - "X-Real-IP"
    - "X-Forwarded-For"
    - "CF-Connecting-IP"

discovery:
  enabled: true
  health_interval: 30s
  failure_threshold: 3
  recovery_timeout: 1m
  mcp_discovery_url: "https://metatool-service.jczstudio.workers.dev/search"

logging:
  level: "debug"
  environment: "development"
  backend: "file"
  buffer_size: 1000
  batch_size: 50
  flush_interval: 5s
  async: true
  config:
    path: "logs/omnimesh-gateway-dev.log"
    max_size: 52428800  # 50MB
    max_files: 10
    rotate: true
    permissions: "0644"
    buffer_size: 8192
    sync_interval: "5s"
  retention:
    days: 30
    policy: "time"

  format: "text"
  request_logging: true
  audit_logging: true
  metrics_enabled: true
  retention_days: 30

redis:
  enabled: true
  host: "${REDIS_HOST:-localhost}"
  port: ${REDIS_PORT:-6379}
  password: "${REDIS_PASSWORD:-}"
  database: ${REDIS_DATABASE:-0}
  max_retries: 3
  pool_size: 10
  pool_timeout: 30s


gateway:
  proxy_timeout: 30s
  max_retries: 3
  load_balancer: "round_robin"
  circuit_breaker:
    enabled: true
    failure_threshold: 3
    recovery_timeout: 30s
    half_open_requests: 5

# Transport Layer Configuration
transport:
  enabled_transports:
    - "HTTP"
    - "SSE"
    - "WEBSOCKET"
    - "STREAMABLE"
    - "STDIO"
  sse_keep_alive: 30s
  websocket_timeout: 60s
  session_timeout: 24h
  max_connections: 1000
  buffer_size: 1024
  streamable_stateful: true
  stdio_timeout: 30s
  path_rewrite:
    enabled: true
    log_level: "info"
    rules:
      - pattern: "^/servers/([^/]+)/mcp(.*)$"
        replacement: "/mcp$2"
        headers:
          X-MCP-Server-ID: "$1"
        context:
          server_id: "$1"
          original_path: "$0"
      - pattern: "^/servers/([^/]+)/sse(.*)$"
        replacement: "/sse$2"
        headers:
          X-MCP-Server-ID: "$1"
        context:
          server_id: "$1"
          original_path: "$0"
      - pattern: "^/servers/([^/]+)/ws(.*)$"
        replacement: "/ws$2"
        headers:
          X-MCP-Server-ID: "$1"
        context:
          server_id: "$1"
          original_path: "$0"
      - pattern: "^/servers/([^/]+)/rpc(.*)$"
        replacement: "/rpc$2"
        headers:
          X-MCP-Server-ID: "$1"
        context:
          server_id: "$1"
          original_path: "$0"
