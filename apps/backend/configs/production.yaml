server:
  host: "0.0.0.0"
  port: 8080
  # base_url: "https://api.yourdomain.com"  # Set this in production via SERVER_BASE_URL env var
  read_timeout: 30s
  write_timeout: 30s
  idle_timeout: 120s
  tls:
    enabled: true
    cert_file: "/etc/ssl/certs/omnimesh-gateway.crt"
    key_file: "/etc/ssl/private/omnimesh-gateway.key"

database:
  host: "${DB_HOST}"
  port: 5432
  database: "${DB_NAME}"
  username: "${DB_USER}"
  password: "${DB_PASSWORD}"
  schema: "public"
  ssl_mode: "require"
  max_open_conns: 100
  max_idle_conns: 25
  max_lifetime: 1h

auth:
  access_token_expiry: 15m
  refresh_token_expiry: 7d
  api_key_expiry: 365d
  password_min_length: 12
  enable_registration: false
  require_email_verify: true

rate_limit:
  enabled: true
  storage: "redis"
  default_per_minute: 60
  default_per_hour: 1000
  default_per_day: 10000
  burst_multiplier: 1.5
  cleanup_interval: 1h
  key_prefix: "ratelimit:prod"
  # IP-based rate limiting
  ip_enabled: true
  ip_requests_per_minute: 60
  ip_skip_paths:
    - "/health"
    - "/metrics"
  ip_custom_headers:
    - "X-Real-IP"
    - "X-Forwarded-For"
    - "CF-Connecting-IP"

discovery:
  enabled: true
  health_check_interval: 30s
  health_check_timeout: 5s
  max_failures: 5
  recovery_time: 2m
  auto_discovery: true
  mcp_discovery_url: "https://metatool-service.jczstudio.workers.dev/search"

logging:
  level: "info"
  format: "json"
  output: "/var/log/omnimesh-gateway/apps/backend/app.log"
  enable_audit: true
  enable_request: true
  request_body_log: false
  response_body_log: false
  max_body_size: 1024

redis:
  enabled: true
  host: "${REDIS_HOST}"
  port: 6379
  password: "${REDIS_PASSWORD}"
  database: 0
  max_retries: 3
  pool_size: 50
  pool_timeout: 30s


gateway:
  default_timeout: 30s
  max_concurrent_reqs: 2000
  load_balance_strategy: "least_connections"
  circuit_breaker:
    enabled: true
    max_requests: 10
    interval: 60s
    timeout: 30s
    failure_threshold: 5
  proxy:
    buffer_size: 65536
    max_idle_conns: 200
    max_idle_conns_per_host: 20
    idle_conn_timeout: 90s
    disable_compression: false
